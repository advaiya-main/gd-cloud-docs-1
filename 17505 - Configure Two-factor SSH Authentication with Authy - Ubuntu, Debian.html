<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:mso="urn:schemas-microsoft-com:office:office" xmlns:msdt="uuid:C2F41010-65B3-11d1-A29F-00AA00C14882">

<head>

<!--Article Number is __________ (fill in blank)-->

<!--Use this template for articles that explain or describe something (such as an operating system). For articles that include steps for accomplishing a task (for example, installing), use the Informational template instead.  -->


<title>17505 - Configure Two-factor SSH Authentication with Authy - Ubuntu, Debian</title>
<style>
div.hacker {
background-color:#666;
border:1px solid #ccc;
color:#fff;
font-family:"Lucida Console","Courier New",Courier,fixed;  font-size:95%;  line-height:160%;  margin-bottom:1.5em;  padding:10px; }

p.note {
 background-color:#ffffe6;
 border:1px solid #eee;
 color:#666;
 padding:.8em 1.6em;
 margin:15px 0;
}

.warning {
 border: 1px #d25100 solid;
 padding: .5em 1em .5em 4em;
 margin: 10px 20px 15px 20px;
 background-image: url('@{help-img-path}/img_warning.gif');
 background-repeat: no-repeat;
 background-position: left top;
 background-color: #ededed;-moz-border-radius:
0.8em;-webkit-border-radius: 0.8em;
 /* -moz-border-bottom-radius: 0;9 */
 -webkit-border-bottom-radius: 0;
 padding-top:14px;
 padding-bottom:15px;
}
</style>


<!--[if gte mso 9]><xml>
<mso:CustomDocumentProperties>
<mso:ArticleKeywords msdt:dt="string">SSH, Security</mso:ArticleKeywords>
<mso:Reference msdt:dt="string">https://www.digitalocean.com/community/tutorials/how-to-install-authy-and-configure-two-factor-authentication-for-ssh, https://www.digitalocean.com/community/tutorials/how-to-install-authy-and-configure-two-factor-authentication-for-ssh</mso:Reference>
<mso:LinuxDistributions msdt:dt="string">;#Ubuntu;#Debian;#</mso:LinuxDistributions>
<mso:ArticlePriority msdt:dt="string">1</mso:ArticlePriority>
<mso:RequestNotes msdt:dt="string">Prereqs - None, but lead off by having reader download Authy app on Android/iOS device.</mso:RequestNotes>
<mso:Difficulty msdt:dt="string">1</mso:Difficulty>
<mso:ForkSplit msdt:dt="string"></mso:ForkSplit>
<mso:ArticleID msdt:dt="string">17505</mso:ArticleID>
<mso:UnsupportedFeatures msdt:dt="string"></mso:UnsupportedFeatures>
<mso:Collapsed msdt:dt="string"></mso:Collapsed>
<mso:Complexity msdt:dt="string"></mso:Complexity>
<mso:Week msdt:dt="string">3.00000000000000</mso:Week>
<mso:ArticleStatus msdt:dt="string">Not started</mso:ArticleStatus>
<mso:HoursDraftingEstimated msdt:dt="string">0.300000000000000</mso:HoursDraftingEstimated>
<mso:HoursEditingEstimated msdt:dt="string">0.100000000000000</mso:HoursEditingEstimated>
<mso:Sample msdt:dt="string">z</mso:Sample>
<mso:DeliveryTarget msdt:dt="string"></mso:DeliveryTarget>
<mso:EditScore msdt:dt="string"></mso:EditScore>
<mso:PrereqOrdering msdt:dt="string">2</mso:PrereqOrdering>
</mso:CustomDocumentProperties>
</xml><![endif]-->
</head>

<body>
<h1>Configure Two-Factor SSH Authentication with Authy – Debian, Ubuntu </h1>

<p><strong>Difficulty:</strong> <em>1</em></p>
<p><strong>Time:</strong> <em>10 minutes.</em></p>

<h2>Introduction</h2>
<p>Authy provides an easier platform for setting up authentication compared to two factor authentication.  It is very simple to install and manage.</p>
<p>In this article, you will learn how to configure two-factor SSH Authentication with Authy. For this, you need to install Authy application in your smartphone. You will get this in Google play. </p>

<h2>Configure Authy in phone</h2>
<p>Download Authy from Google play and then you need to configure Authy by getting verified your mobile number.</p>

<h2>Configure Authy in phone  </h2>
<p>Build a developer account in the following URL.</p>
<code>https://dashboard.authy.com/signup</code>

<p>Make sure that you use the same mobile number which you have used in the Authy application. </p>
<p>Verify your account by completing the verification process sent in to your registered email account. You will get a token in your mobile.</p>

<h2>Create an application</h2>
<p>Log in to your developer account. You will be asked to create an application. </p>
<p><img src="images/17505 - 1.png" alt="17505" /></p>
<p><img src="images/17505 - 2.png" alt="17505" /></p>

<p>You will get an API key once you finish with the application</p>
<p><img src="images/17505 - 3.png" alt="17505" /></p> 

<p>Copy the API key as it is. You will need this in further steps.</p>

<h2>Configure server</h2>
<p>Download Authy Installer.
<div class="hacker">curl "https://raw.githubusercontent.com/authy/authy-ssh/master/authy-ssh" -o authy-ssh</div>

<p>Install Authy.</p>
<div class="hacker">sudo bash authy-ssh install /usr/local/bin</div>
<p>It will ask you a prompt. You need to enter the API key here, which you have received from Authy website. Choose what to do when Authy is down. Here you can choose option 1.</p>

<h2>Configure Two-Factor for user</h2>
<p>Run below command to configure user.</p>
<div class="hacker">sudo /usr/local/bin/authy-ssh enable <whoami> email country number</div>
<p>Give the user name in whoami field followed by email and mobile number with country code.</p>

<p>Restart SSH server.</p>
<div class="hacker">sudo service ssh restart</div>
<p>or</p>
<div class="hacker">sudo /etc/init.d/sshd restart</div>

<p>Make sure that the command is in your/etc/ssh/sshd_config file.</p>
<div class="hacker">cat /etc/ssh/sshd_config | grep ForceCommand</div>
<p>If the command was not installed in your /etc/ssh/sshd_config file, manually enter it and restart SSH again.</p>
<div class="hacker">ForceCommand /usr/local/bin/authy-ssh login</div>
<div class="hacker">sudo service ssh restart</div>
<p>or</p>
<div class="hacker">sudo /etc/init.d/sshd restart</div>
<p>Uninstall using below command:</p>
<div class="hacker">sudo /usr/local/bin/authy-ssh uninstall</div>

<h2>Conclusion</h2>
<p>In this article, you have learnt to configure two factor authentication in SSH server using Authy. You can know more about configuring two factor authentication by using Google Authenticator from below URL.</p>
<p><a href="#"> Configure Two-factor SSH Authentication with PAM</a></p>

</body>
</html>