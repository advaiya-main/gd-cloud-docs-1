<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:mso="urn:schemas-microsoft-com:office:office" xmlns:msdt="uuid:C2F41010-65B3-11d1-A29F-00AA00C14882">

<head>

<!--Article Number is __________ (fill in blank)-->

<!--Use this template for articles that explain or describe something (such as an operating system). For articles that include steps for accomplishing a task (for example, installing), use the Informational template instead.  -->


<title>Back up your server with Bacula - Ubuntu, Debian</title>
<style type="text/css">
div.hacker {
background-color:#666;
border:1px solid #ccc;
color:#fff;
font-family:"Lucida Console","Courier New",Courier,fixed;  font-size:95%;  line-height:160%;  margin-bottom:1.5em;  padding:10px; }

p.note {
 background-color:#ffffe6;
 border:1px solid #eee;
 color:#666;
 padding:.8em 1.6em;
 margin:15px 0;
}

.warning {
 border: 1px #d25100 solid;
 padding: .5em 1em .5em 4em;
 margin: 10px 20px 15px 20px;
 background-image: url('@{help-img-path}/img_warning.gif');
 background-repeat: no-repeat;
 background-position: left top;
 background-color: #ededed;-moz-border-radius:
0.8em;-webkit-border-radius: 0.8em;
 /* -moz-border-bottom-radius: 0;9 */
 -webkit-border-bottom-radius: 0;
 padding-top:14px;
 padding-bottom:15px;
}
</style>


<!--[if gte mso 9]><xml>
<mso:CustomDocumentProperties>
<mso:ArticleKeywords msdt:dt="string">Backups</mso:ArticleKeywords>
<mso:Reference msdt:dt="string">https://www.digitalocean.com/community/tutorials/how-to-back-up-an-ubuntu-14-04-server-with-bacula, https://www.digitalocean.com/community/tutorials/how-to-back-up-an-ubuntu-14-04-server-with-bacula</mso:Reference>
<mso:LinuxDistributions msdt:dt="string">;#Debian;#Ubuntu;#</mso:LinuxDistributions>
<mso:ArticlePriority msdt:dt="string">5</mso:ArticlePriority>
<mso:RequestNotes msdt:dt="string"></mso:RequestNotes>
<mso:Difficulty msdt:dt="string">3</mso:Difficulty>
<mso:ForkSplit msdt:dt="string"></mso:ForkSplit>
<mso:ArticleID msdt:dt="string">18409</mso:ArticleID>
<mso:UnsupportedFeatures msdt:dt="string"></mso:UnsupportedFeatures>
<mso:Collapsed msdt:dt="string"></mso:Collapsed>
<mso:ArticleStatus msdt:dt="string">Not started</mso:ArticleStatus>
<mso:Complexity msdt:dt="string"></mso:Complexity>
<mso:Sample msdt:dt="string">z</mso:Sample>
<mso:HoursDraftingEstimated msdt:dt="string">1.50000000000000</mso:HoursDraftingEstimated>
<mso:HoursEditingEstimated msdt:dt="string">0.500000000000000</mso:HoursEditingEstimated>
<mso:DeliveryTarget msdt:dt="string">Phase 2</mso:DeliveryTarget>
<mso:EditScore msdt:dt="string"></mso:EditScore>
<mso:PrereqOrdering msdt:dt="string">2</mso:PrereqOrdering>
<mso:AssignedTo1 msdt:dt="string">12</mso:AssignedTo1>
<mso:display_urn_x003a_schemas-microsoft-com_x003a_office_x003a_office_x0023_AssignedTo1 msdt:dt="string">Tom Taylor</mso:display_urn_x003a_schemas-microsoft-com_x003a_office_x003a_office_x0023_AssignedTo1>
<mso:Week msdt:dt="string">8.00000000000000</mso:Week>
<mso:ReviewComments msdt:dt="string"></mso:ReviewComments>
<mso:Dependencies msdt:dt="string"></mso:Dependencies>
<mso:TestComments msdt:dt="string"></mso:TestComments>
</mso:CustomDocumentProperties>
</xml><![endif]-->
</head>

<body>
<p>Back up your server with Bacula - Ubuntu, Debian, Backups</p>
    <h1>Back up your server with Bacula – Debian, Ubuntu </h1>
    
    <p><strong>Difficulty</strong>: <em>3</em><br/>
        <strong>Time</strong>: <em>1 hour</em></p>

    <p>Bacula is one of the powerful open-source tool to manage, backup, recover and verify network and remote machines. Bacula is a flexible and robust solution for small, medium and large scale enterprises. 
This article shows how to install and configure Bacula on Ubuntu machine and carry out a daily, weekly and monthly backup.
</p>

    <h2>Basic understanding of Bacula</h2>
    <p>As described above, about Bacula is an open source project to manage, backup and restore data. Below are the descriptions of various configuration files used by Bacula.</p>
 	<table border="1">
	<tr>
	<td>Bacual Director: </td>
	<td><code>bacula-dir.conf</code> which mange the operation of backup and restore data by daemons.</td>
	</tr>
	
	<tr>
	<td>Bacula Storage: </td>
	<td><code>bacula-sd.conf</code> file which having configuration for read/write backup devices.</td>
	</tr>
	
	<tr>
	<td>Bacula File Storage: </td>
	<td><code>bacula-fd.conf </code>list Directors who are permitted to contact this File daemon.</td>
	</tr>
	
	<tr>
	<td>Bacula Console: </td>
	<td>To perform various commands to interact with <code>bacula-dir.</code></td>
	</tr>
	</table>
	
	<h2>Basic terms used in this article</h2>
	<table border="1">
	<tr>
	<td>BackupServer: </td>
	<td>BackServer the place where you want to keep all backups of clients or remote machines.</td>
	</tr>
	
	<tr>
	<td>Client/Bacula Client: </td>
	<td>Bacula Client/Client is the machine from which you want to take backup and restore taken backup from the BackupServer.</td>
	</tr>
	</table>
	
    <h2>Prerequisites</h2>
	<ol>
	<li>Ubuntu Server</li>
	<li>Private Network or two different machine</li>
	<li>Sudo User</li>
	</ol>
	
	<h2>Install Bacula on the server</h2>
	<p>To configure Bacula, you require two or more machines as server and clients respectively, so here Machine1 is defined as BackupServer where you will place clients’ machine IP or network machine’s backup.</p>
<ol> 
<li>Install Bacula on Ubuntu Machine using the following command:
   <div class="hacker">sudo apt-get install bacula</div>
   <p>It will install all the default dependencies for Bacula such as bacula-server, bacula-client and MySQL</p>
   </li>
   <li>Configure bacula mysql driver for database usage.
   </li>
   <li>Type the administrative account password for mysql.
   </li>
   <li>Provide mysql database password to connect with the database server. If you leave it blank, mysql password will generated.
   </li>
  </ol>
  
  <h2>Install the Bacula client</h2>
  <p>Open Machine2 that is taken here as bacula client from which the backup will be taken.</p>
<ol> 
<li>Open the terminal in client machine.
   </li>
   <li>Install Bacula client using the following command:
   <div class="hacker">sudo apt-get update</div>
   <div class="hacker">sudo apt-get bacula-client</div>
   </li>
   </ol>
   
   <h2>Create a directory for backup and restore</h2>
   <ol>
   <li>Create a backup and restore directory to place our backup and restore path on both the machines (BackupServer/Client).
   <div class="hacker">sudo mkdir -p /bacula/backup /bacula/restore</div>
   </li>
   <li>Give permission to bacula user to read/write into the directory.
   <div class="hacker">sudo chown -R bacula:bacula /bacula</div>
   <div class="hacker">sudo chmod -R 700 /bacula</div>
   </li>
  </ol>
  
  <h2>Configure the client machine:</h2>
<ol> 
<li>Open the client machine where you installed bacula-client for the necessary configuration.
   </li>
   <li>Open the file namely <code>bacula-fd.conf </code>in your favorite editor:
   <div class="hacker">sudo vim /etc/bacula/bacula-fd.conf</div>
   </li>
   <li>Keep the file open, jump to BackupServer machine and open the file <code>bacula-dir.conf</code>:
   <ol type="a">
   <li>Find the section “Director {” and, copy and paste the name given against <strong>Name</strong> parameters.  
   <div class="hacker">
   Director {<br />
     Name = BackupServer-dir <br/>
     …..<br/>
     …..<br/>
}
   </div>
   <p class="note">The name would be different in your machine but it will have the same postfix <strong>–dir.</strong></p>
   </li>
   <li>Find one more section “Client {” and, copy and paste the password given against the <strong>Password </strong>label. Make sure that the section has its name similar to the director:
   <div class="hacker">
   Client {<br/> 
       Name = BackupServer-dir <br/>
       Address = xxx.xxx.xxx.xxx<br/>
       Password = “IVwwRSUFLYcbTdAuapez-5Zg26PefmvIA”<br/>
}
   </div>
   </li></ol>
   </li>
   <li>Jump to the Bacual-client machine and add the following configuration in the <code>bacula-fd.conf</code>: 
   <div class="hacker">
   Director {<br/>
           Name = Bacula-BackupServer-dir<br/>
           Password = "IVwwRSUFLYcbTdAuapez-5Zg26PefmvIA"  # Copy this password for later reference!<br/>
}
   </div>
   </li>
   <li>Find the line “FileDaemon {” and change the IP address in <strong>FDAddress </strong>variable from localhost to Bacula client machine IP.
   <div class="hacker">
FDAddress = public_IP # FQDN <br/>
FileDaemon {                          # this is me<br/>
  Name = Bacula-client<br/>
  FDport = 9102                  # where we listen for the director<br/>
  WorkingDirectory = /var/lib/bacula<br/>
  Pid Directory = /var/run/bacula<br/>
  Maximum Concurrent Jobs = 20<br/>
  FDAddress = 192.xxx.xxx.xxx<br/>
}
   </div>
   </li>
   <li>Change the message director to log.
   <div class="hacker">
   Messages {<br/>
  Name = Standard<br/>
  director = Bacula-BackupServer-dir = all, !skipped, !restored<br/>
}
   </div>
   </li>
<li>Define the fileset which you want to backup into the <strong>Fileset</strong> Section:
	<ol type="a">
	<li>To include backup files and folder, write it under the sub section <strong>Include.</strong>.
   </li>
   <li>To exclude backup files and folder, write it under the sub section <strong>Exclude.</strong>
   <p>Below is example for backup FileSet:</p>
   <div class="hacker">
   FileSet {<br/>
  Name = "Full Set"<br/>
  Include {<br/>
    Options {<br/>
      signature = MD5<br/>
    }<br/>
    File = /usr/sbin<br/>
    File = /home/<br/>
  }<br/>
  Exclude {<br/>
    File = /bacula<br/>
  }<br/>
}
   </div>
   </li>
   </ol>
   </li>
   <li>Save and exit the file by pressing the <strong>ESC</strong>. key, and then typing <strong>:wq</strong>, followed by the <strong>Enter</strong> key.
   </li>
   <li>Restart the Bacula-Client machine to effect the changes:
   <div class="hacker">sudo service bacula-fd restart</div>
   </li>
   
  </ol>
  
  <h2>Configure the BackupServer:</h2>
  <p>Switch to the BackupSever machine and update the configuration.</p>
<ol> 
<li>Open the file <strong>bacula-dir.conf</strong> in your favorite editor, if not already opened. Go to the top of the file, then go to the section <strong>Director</strong> {update the <strong> Address</strong> label to the FQDN or Public_IP:
   <div class="hacker">DirAddress = BackupServer_IP </div>
   </li>
   <li>Change the configuration name of default <strong>BackupClient1</strong> to an easy to remember name:
   <div class="hacker">
   Job {<br/>
  Name = "LocalBackup"<br/>
  JobDefs = "DefaultJob"<br/>
}
   </div>
   </li>
   <li>Add another section namely <strong>Job</strong>for the remote backup:
   <div class="hacker">
    Job {<br/>
  Name = "RemoteBackup"<br/>
  JobDefs = "DefaultJob"<br/>
  Client = Bacula-Client-fd<br/>
  Pool = RemoteFile<br/>
}
   </div>
   </li>
   <li>Define a place for the remote backup to restore. Use the directory that you created on the client machine to restore remote backups. Find the "RestoreFiles" job definition, copy and paste configuration to the file.
   <div class="hacker">
   Job {<br/>
  Name = "RestoreRemote"<br/>
  Type = Restore<br/>
  Client = Bacula-Client-fd<br/>
  FileSet = "Full Set"<br/>
  Storage = File     <br/>
  Pool = Default<br/>
  Messages = Standard<br/>
  Where = /bacula/restore<br/>
}
   </div>
   </li>
   <li>Find the “Client {” section in<code> bacula-dir.conf</code> file having name like <strong>BackupServer-fd</strong>:
   <div class="hacker">
   Client {<br/>
  Name = BacupServer-fd<br/>
  Address = BacupServer-ip<br/>
  FDPort = 9102<br/>
  Catalog = MyCatalog<br/>
  Password = " IVwwRSUFLYcbTdAuapez-5Zg26PefmvIA"          # password for FileDaemon<br/>
  File Retention = 30 days            # 30 days<br/>
  Job Retention = 6 months            # six months<br/>
  AutoPrune = yes                     # Prune expired Jobs/Files<br/>
}
   </div>
   </li>
   <li>Add a new client section for Bacula-client from where Bacula-director can connect:
   <div class="hacker">
   Client {<br/>
  Name = BaculaClient-fd<br/>
  Address = client-machine-IP<br/>
  FDPort = 9102<br/>
  Catalog = MyCatalog<br/>
  Password = "u2LK-yBrQzfiEsc6NWftHEhymmdPWsklN"       # password for Remote FileDaemon<br/>
  File Retention = 30 days            # 30 days<br/>
  Job Retention = 6 months            # six months<br/>
  AutoPrune = yes                     # Prune expired Jobs/Files<br/>
}
   </div>
   </li>
   <li>Save and exit the file by pressing the <strong>ESC</strong> key, and then typing <strong>:wq</strong>, followed by the <strong>Enter</strong> key.
   </li>
  </ol>
  
  <h2>Configure storage in BackupServer:</h2>
<ol> 
<li>Again open the file <strong>bacula-dir.conf</strong> in your favorite editor.
   <div class="hacker">sudo vim /etc/bacula/bacula-dir.conf</div>
   </li>
   <li>Change the address of the storage section with <strong>public-ip or FQDN</strong>:
   <div class="hacker">
   Storage {<br/>
  Name = File<br/>
# Do not use "localhost" here   <br/>
  Address = BackupServer-ip # N.B. Use a fully qualified name here<br/>
  SDPort = 9103<br/>
  Password = "097dnj3jw1Yynpz2AC38luKjy5QTnGoxS"<br/>
  Device = FileStorage<br/>
  Media Type = File<br/>
}
   </div>
   </li>
   <li>Update the pool configuration. The Pool resource defines the set of storage volumes (tapes or files) to be used by Bacula to write the data. Change the <strong>Label Format</strong> to store backup prefix with this name. 
   <div class="hacker">
   Pool {<br/>
  Name = File<br/>
  Pool Type = Backup<br/>
  Recycle = yes                       # Bacula can automatically recycle Volumes<br/>
  Label Format = LocalBacup-<br/>
  AutoPrune = yes                     # Prune expired volumes<br/>
  Volume Retention = 365 days         # one year<br/>
  Maximum Volume Bytes = 50G          # Limit Volume size to something reasonable<br/>
  Maximum Volumes = 100               # Limit number of Volumes in Pool<br/>
}
   </div>
   </li>
   <li>Copy the current section and paste it below the current entry. This will be set up for remote backup storage.
   <p>Change the name of the new pool to reflect its job of storing remote backups. Also, change the prefix by adjusting the "Label Format" parameter to be "Remote-":</p>
   <div class="hacker">
   Pool {<br/>
  Name = RemoteFile<br/>
  Pool Type = Backup
  Recycle = yes                       # Bacula can automatically recycle Volumes<br/>
  Label Format = Remote-<br/>
  AutoPrune = yes                     # Prune expired volumes<br/>
  Volume Retention = 365 days         # one year<br/>
  Maximum Volume Bytes = 50G          # Limit Volume size to something reasonable<br/>
  Maximum Volumes = 100               # Limit number of Volumes in Pool<br/>
}
   </div>
   </li>
   <li>Save and exit the file by pressing the <strong>ESC</strong> key, and then typing <strong>:wq</strong>, followed by the <strong>Enter</strong> key.
   </li>
  </ol>
  
  <h2>Configure the storage Daemon</h2>
<ol> 
<li>Open the file <code>bacula-sd.conf </code>for storage daemon.
   <div class="hacker">sudo vim /etc/bacula/bacula-sd.conf</div>
   </li>
   <li>Change the "SDAddress" parameter to reflect the backup server's IP address or domain name:
   <div class="hacker">
   Storage {                             # definition of myself<br/>
  Name = BackupServer-sd<br/>
  SDPort = 9103                  # Director's port<br/>
  WorkingDirectory = "/var/lib/bacula"<br/>
  Pid Directory = "/var/run/bacula"<br/>
  Maximum Concurrent Jobs = 20<br/>
  SDAddress = BackupServer-ip<br/>
}
   </div>
   </li>
   <li>Save and exit the file by pressing the <strong>ESC</strong> key, and then typing <strong>:wq</strong>, followed by the <strong>Enter </strong>key.
   </li>
   </ol>
   
   <h2>Validate syntaxes and configuration</h2>
   <ol>
   <li>Check the Bacula director configuration and syntax errors by typing the following command:
   <div class="hacker">sudo bacula-dir /etc/bacula/bacula-dir.conf</div>
   </li>
   <li>Check the Bacula storage daemon configuration and syntax errors by typing the following command:
   <div class="hacker">sudo bacula-sd /etc/bacula/bacula-sd.conf</div>
   </li>
   </ol>
   
   <h2>Restart server and daemons</h2>
   <ol>
   <li>Restart Bacula director to make the changes effective using the following command:
   <div class="hacker">sudo service bacula-director restart</div>
   </li>
   <li>Restart Bacula storage daemon to make the changes effective using the following command:
   <div class="hacker">sudo service bacula-sd restart</div>
   </li>
  </ol>
  
  <h2>Test the backupserver</h2>
<ol> 
<li>Start the Bacula console using the following command:
   <div class="hacker">sudo bconsole</div>
   </li>
   <li>Type status command to list the available backup machine clients:
   <div class="hacker">status</div>
   </li>
   <li>Bconsole will display the list of clients to backup.Press 3 to select daemon type for status
  </li>
   <li>Choose the defined client resources
   </li>
   <li>Run a backup test using the following command:
  
   </li>
   <li>Choose the job from the list displayed by Bacula console, Press 2 here.
   </li>
   <li>After pressing 2, Bacula console will show you the information about the chosen client. Confirm by typing Yes.
   <p>Bacula will start the process of the backup.</p>
   </li>
  </ol>
  
  <h2>Command to check the jobs</h2>
<ol> 
<li>Check the status of various running jobs using the following command:
   <div class="hacker">status dir</div>
   </li>
   <li>Check the messages of jobs whether error, success or any using the following command:
   <div class="hacker">messages</div>
   </li>
   </ol>
   
   <h2>Restore the backup</h2>
   <ol>
   <li>Restore backup on the client machine using the following command:
   <div class="hacker">restore all</div>
   </li>
   <li>Restore command will display the list of what kind of backup you want to restore. Press 5.
   </li>
   <li>Choose the client, which you want to restore from the list displayed by Bacula console. Press 3 
   </li>
   <li>Choose the backup type FileSet resources. Press 2
   </li>
   <li>Use <strong>done</strong> command to execute the backup process. Press 1
   <div class="hacker"></div>
   </li>
<li>After choosing the <strong>Restore</strong> job resource, Bacula prompts you for confirmation. Type<strong> Yes </strong>for confirmation: 
   <div class="hacker">OK to run? (yes/mod/no): yes</div>
   </li>
   </ol>
   
   <h2>Verify the restoration</h2>
   <ol>
   <li>Go to the Bacula-client machine and type the following command:
   <div class="hacker">sudo ls -R /bacula/restore</div>
  	<p>The above command will show a list of those files which you defined in BackupServer Fileset.</p>
   </li>
  </ol>
  
             
    <h2>Conclusion</h2>
    <p>In this article, you learned to backup your server with Bacula on Debian and Ubuntu. </p>
   
</body>
</html>