<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:mso="urn:schemas-microsoft-com:office:office" xmlns:msdt="uuid:C2F41010-65B3-11d1-A29F-00AA00C14882">

<head>


<title>Set up WordPress Multisite in Apache - Debian, Ubuntu</title>
<style>
div.hacker {
background-color:#666;
border:1px solid #ccc;
color:#fff;
font-family:"Lucida Console","Courier New",Courier,fixed;  font-size:95%;  line-height:160%;  margin-bottom:1.5em;  padding:10px; }

p.note {
 background-color:#ffffe6;
 border:1px solid #eee;
 color:#666;
 padding:.8em 1.6em;
 margin:15px 0;
}

.warning {
 border: 1px #d25100 solid;
 padding: .5em 1em .5em 4em;
 margin: 10px 20px 15px 20px;
 background-image: url('@{help-img-path}/img_warning.gif');
 background-repeat: no-repeat;
 background-position: left top;
 background-color: #ededed;-moz-border-radius:
0.8em;-webkit-border-radius: 0.8em;
 /* -moz-border-bottom-radius: 0;9 */
 -webkit-border-bottom-radius: 0;
 padding-top:14px;
 padding-bottom:15px;
}
</style>


<!--[if gte mso 9]><xml>
<mso:CustomDocumentProperties>
<mso:ArticleKeywords msdt:dt="string">WordPress, Apache, LAMP</mso:ArticleKeywords>
<mso:Reference msdt:dt="string">https://www.digitalocean.com/community/tutorials/how-to-set-up-multiple-wordpress-sites-using-multisite, https://www.digitalocean.com/community/tutorials/how-to-set-up-multiple-wordpress-sites-using-multisite</mso:Reference>
<mso:LinuxDistributions msdt:dt="string">;#Debian;#Ubuntu;#</mso:LinuxDistributions>
<mso:ArticlePriority msdt:dt="string">2</mso:ArticlePriority>
<mso:RequestNotes msdt:dt="string">Prereq - 'Initial Server Setup,' 'Build a LAMP stack,' 'Install WordPress on your LAMP server' for that fork. Multisite guide.</mso:RequestNotes>
<mso:Difficulty msdt:dt="string">1</mso:Difficulty>
<mso:ForkSplit msdt:dt="string"></mso:ForkSplit>
<mso:ArticleID msdt:dt="string">17680</mso:ArticleID>
<mso:UnsupportedFeatures msdt:dt="string"></mso:UnsupportedFeatures>
<mso:Collapsed msdt:dt="string"></mso:Collapsed>
<mso:Complexity msdt:dt="string"></mso:Complexity>
<mso:ArticleStatus msdt:dt="string">Not started</mso:ArticleStatus>
<mso:HoursDraftingEstimated msdt:dt="string">0.300000000000000</mso:HoursDraftingEstimated>
<mso:HoursEditingEstimated msdt:dt="string">0.100000000000000</mso:HoursEditingEstimated>
<mso:Sample msdt:dt="string">z</mso:Sample>
<mso:DeliveryTarget msdt:dt="string"></mso:DeliveryTarget>
<mso:EditScore msdt:dt="string"></mso:EditScore>
<mso:PrereqOrdering msdt:dt="string">2</mso:PrereqOrdering>
</mso:CustomDocumentProperties>
</xml><![endif]-->
</head>

<body>
<p>Install WordPress Multisite in Apache on a LAMP stack for Debian or Ubuntu</p>
    <h1>Set up WordPress Multisite in Apache - Debian, Ubuntu</h1>
     
    <p><strong>Difficulty</strong>: <em><u>2</u></em><br/>
        <strong>Time</strong>: <em><u>20 minutes</u></em></p>

  <p>You can manage multiple sites under one WordPress installation. This setup is a great convenience if you manage many sites completely independent of each other (or sites that are related, such as subdomains), as you’d otherwise have to log into different WordPress accounts.</p> 

<p>For this article, we'll walk through setting up WordPress multisite for a primary domain and its subdomains. 
We'll set up a fresh install of WordPress in Apache on an Ubuntu or Debian system. The steps are for a non-root user with <code>sudo</code> privileges.</p>
<p>We'll use these example sites: </p>
<table>
  <tr>
    <td><b>Site 1</b></th>
    <td>coolexample.com (primary)</td>
  </tr>
  <tr>
    <td><b>Site 2</b></td>
    <td>coolexampleproduct.com<br/>
product.coolexample.com</td>
  </tr>
  <tr>
    <td><b>Site 3</b></td>
    <td>coolexamplecompany.com<br/>
aboutus.coolexample.com</td>
  </tr>
</table>

<h2>Prerequisites</h2>

<ul>
<li>You'll need a Linux, Apache&reg;, MySQL, and PHP (LAMP) stack configured. Make sure that Apache, MySQL, and PHP are up and running. For a how-to on installing a LAMP stack, see <a href="https://blueprintcs.sharepoint.com/sites/gdcmp/Articles/17341%20-%20Build%20a%20LAMP%20stack%20(Linux,%20Apache,%20MySQL,%20PHP)%20-%20Ubuntu.html">Build a LAMP stack (Linux, Apache, MySQL, PHP) – Ubuntu</a></p>

<p>As you install the software, make a note of your MySQL root account (administrator) password. You'll need it for these tasks.</p></li> 

<li>Install <code>wget</code> if you haven't already. 
        <div class="hacker">sudo apt-get install wget</div></li>
        
<li>Install this php module that WordPress needs to run properly.
<div class="hacker">sudo apt-get install php5-gd</div></li>

                                                          
<p>Select <strong>y</strong> at each prompt to continue with the installation.</p></li>


<li>You'll also need to set up the DNS for all your domains. Point them to the IP that will host your WordPress. Make sure to <a href="https://www.godaddy.com/help/setting-up-wildcard-dns-3301">set up wildcard DNS</a> if you're creating subdomains. To point your domain name to a cloud server, see <a href="https://www.godaddy.com/help/point-your-domain-name-to-a-server-19116">Point your domain name to a server</a>.</li>
       </ul>
                    
 <h2>Create a MySQL database and administrator for WordPress</h2>
   
    <p>Set up your MySQL database with an administrator so that WordPress has a place to store all your site and user information.</p>

<p class="warning">Remember: All <b>MySQL</b> code statements must end with a semi-colon (;).</p>

<ol>

    <li>Log into your MySQL admin account. <br />
<div class="hacker">mysql -u root -p</div>
                     </li>
 
        <li>At the prompt, enter your MySQL root password.  </li>
    <li>At the MySQL prompt, create your WordPress database. For this tutorial, we’ll use the database name fittingly as “wordpress.”
<div class="hacker">CREATE DATABASE wordpress;</div></li>
<li>Create the database administrator account and set the user’s credentials. For this tutorial, we’ll use “wordpressadmin” as the example user name, and “wordpresspassword” as the password.
<div class="hacker">CREATE USER wordpressadmin@localhost IDENTIFIED BY 'wordpresspassword';</div>
<p>As a good security practice, create a strong password. Keep your username and password handy, as you’ll need them later.</p></li>
 <li>Give, or grant, your admin permissions to the database.   
<div class="hacker">GRANT ALL PRIVILEGES ON wordpress.* TO wordpressadmin@localhost;</div>
<code>GRANT</code> is one of the account management statements the MySQL server notices and loads into memory right away. So a manual reload/restart should not be necessary. But if you’d like, you can check the permissions using <code>SHOW GRANTS</code>.
<div class="hacker">SHOW GRANTS FOR 'wordpressadmin'@'localhost';</div>
</li>

   <li>If, for some reason the privileges didn’t take, flush the privileges to activate the user. Flush forces a reload of the cache.     <br />
<div class="hacker">FLUSH PRIVILEGES;</div>  </li>

<li> You're finished with the MySQL part! Exit MySQL to bring you back to your normal command prompt:
<div class="hacker">exit</div> </li>
  </ol>

              
   <h2>Download WordPress</h2>           
     
     Your system is now ready for installing WordPress into your directory. WordPress is available in a tar.gz or zip format. We will be getting the tar.gz file.
     
     <ol>
     <li>Download the WordPress files from the official site using <code>wget</code>.
<div class="hacker">cd ~</div>
<div class="hacker">wget http://wordpress.org/latest.tar.gz    </div>
This URL will always link to a compressed file of the latest stable version of WordPress.      </li>
         
         <li>Extract, or untar, the application directory:

<div class="hacker">tar xzvf latest.tar.gz </div>
<p>This creates a directory <code>wordpress</code> in your home directory.</p></li>
</ol>

                            
  <h2>Copy files to document root</h2>   
     
   <p>After you’ve configured WordPress, transfer the files to Apache’s root directory so that the application can serve content to your site visitors.</p>
      
 <ol>
 <li>Transfer your WordPress files to the website's root directory
    <div class="hacker">sudo cp -r ~/wordpress/* /var/www/html</div>
This will safely copy all of the contents from the directory you unpacked to the document root.
      </li>   
 
 <li>Let's also set directory permissions at this point so that you can work with WordPress content (e.g., uploading images).
 Make the group ownership recursive to make sure it will write to your subdirectories:  
 <div class="hacker">sudo chown www-data:www-data /var/www/html * -R</div>
<div class="hacker">sudo chmod u+x /var/www/html * -R</div>
                                  
<!--CT: internal note (alternative permissions)...
sudo chown -R [USER NAME]:[USER NAME] /var/www
           </p>                                   ...-->
      
 <li>Restart Apache.
<div class="hacker">sudo service apache2 restart</div>
                               </li> </ol>
      
<h2>Modify the WordPress configuration files</h2> 

  <h3>Modify your wp-config file to enable multisites</h3>     
   <ol>
   
   <li>Back in the terminal, navigate to your WordPress document root.
     <div class="hacker">cd /var/www/html</div></li>

 <li>Open your configuration file for editing.
   <div class="hacker">sudo vim wp-config.php</div></li>
 
 <li>Farther down in the file, find the line  <code>/* That's all, stop editing! Happy blogging. */</code> and add  these lines:
   <div class="hacker">/* Multisite settings */<br/>
define( 'WP_ALLOW_MULTISITE', true );</div></li>
    
    <li>Save and close the file.</li>
                    </ol>
  
  <h3>Enable mod rewrite</h3>
  
  <p>Activate the apache Mod_Rewrite module.</p>

  <div class="hacker">sudo a2enmod rewrite</div>         

Your output message might look like this.
  <div class="hacker"><pre>Enabling module rewrite.
To activate the new configuration, you need to run:
  service apache2 restart</pre></div>
         
   We will be restarting Apache after this step.
   
   Open your virtual host config file. We'll use the default Apache one.
            sudo nano /etc/apache2/sites-enabled/000-default.conf
            
Search for DocumentRoot, and add the following lines under it: 
<div class="hacker"><pre><Directory "/var/www/html">
    AllowOverride All
</Directory></pre></div>
So it will look like:
<div class="hacker"><pre>DocumentRoot /var/www/html
        <Directory "/var/www/html">
    AllowOverride All
</Directory></pre></div>


******IF THOSE DON'T WORK - TRY MODIFYING THIS FILE INSTEAD*****
 sudo nano /etc/apache2/apache2.conf

 <li>Save and close.</li>

 <li>Restart Apache.
<div class="hacker">sudo service apache2 restart</div>
                               </li> </ol>


<h2>Install WordPress</h2> 

      <p>Now you can access the WordPress web interface.</p>             
     <ol>
     <li>  In your web browser, enter your primary domain name. In our example, that's 
   <strong>http://coolexample.com</strong>.
   (If the Apache default page displays, append <code>/wp-admin/ </code>to your URL.)<br/>
   You should get an introductory page:<br />
  Click <strong>Let's go!</strong> to continue.</li>

     <li>On the next page, fill out your WordPress MySQL database credentials. 
     You can leave the Database Host as is (localhost), since that's what we defined, and Table Prefix as wp_. </li>
  <li>Click <strong>Submit</strong>.<br /> </li>

<li>Your next screen will be the main WordPress 5-minute install screen and will look something like this.<br/>
<img src="https://blueprintcs.sharepoint.com/sites/gdcmp/Articles/images/17680/090315/install-wordpress-on-your-server-welcome-filledout-1.png" alt="install wordpress on server welcome filled out" />

Choose a user name and password. Use the password supplied if you like; just be sure to save it somewhere handy.
</li>

<li>Click <strong>Install WordPress</strong>. The install might take a few minutes.</li>

<li>You'll get a "Success!" screen with your login credentials. Click <strong>Log In</strong> to continue.</li>     
 
<li>Your next screen will prompt you to log in again. Do so now with your newly-created username and password.</li>    
      </ol>


      




</body>
</html>