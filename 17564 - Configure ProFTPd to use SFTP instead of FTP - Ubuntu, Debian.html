<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:mso="urn:schemas-microsoft-com:office:office" xmlns:msdt="uuid:C2F41010-65B3-11d1-A29F-00AA00C14882">

<head>

<!--Article Number is __________ (fill in blank)-->

<!--Use this template for articles that explain or describe something (such as an operating system). For articles that include steps for accomplishing a task (for example, installing), use the Informational template instead.  -->


<title>Configure ProFTPd to use SFTP instead of FTP - Ubuntu, Debian</title>
<style type="text/css">
div.hacker {
background-color:#666;
border:1px solid #ccc;
color:#fff;
font-family:"Lucida Console","Courier New",Courier,fixed;  font-size:95%;  line-height:160%;  margin-bottom:1.5em;  padding:10px; }

p.note {
 background-color:#ffffe6;
 border:1px solid #eee;
 color:#666;
 padding:.8em 1.6em;
 margin:15px 0;
}

.warning {
 border: 1px #d25100 solid;
 padding: .5em 1em .5em 4em;
 margin: 10px 20px 15px 20px;
 background-image: url('@{help-img-path}/img_warning.gif');
 background-repeat: no-repeat;
 background-position: left top;
 background-color: #ededed;-moz-border-radius:
0.8em;-webkit-border-radius: 0.8em;
 /* -moz-border-bottom-radius: 0;9 */
 -webkit-border-bottom-radius: 0;
 padding-top:14px;
 padding-bottom:15px;
}
</style>


<!--[if gte mso 9]><xml>
<mso:CustomDocumentProperties>
<mso:ArticleKeywords msdt:dt="string">Security, Linux Basics</mso:ArticleKeywords>
<mso:Reference msdt:dt="string">https://www.digitalocean.com/community/tutorials/how-to-configure-proftpd-to-use-sftp-instead-of-ftp, https://www.digitalocean.com/community/tutorials/how-to-configure-proftpd-to-use-sftp-instead-of-ftp</mso:Reference>
<mso:LinuxDistributions msdt:dt="string">;#Ubuntu;#Debian;#</mso:LinuxDistributions>
<mso:ArticlePriority msdt:dt="string">1</mso:ArticlePriority>
<mso:RequestNotes msdt:dt="string"></mso:RequestNotes>
<mso:Difficulty msdt:dt="string">1</mso:Difficulty>
<mso:ForkSplit msdt:dt="string"></mso:ForkSplit>
<mso:ArticleID msdt:dt="string">17564</mso:ArticleID>
<mso:UnsupportedFeatures msdt:dt="string"></mso:UnsupportedFeatures>
<mso:Collapsed msdt:dt="string"></mso:Collapsed>
<mso:Complexity msdt:dt="string"></mso:Complexity>
<mso:Week msdt:dt="string">3.00000000000000</mso:Week>
<mso:ArticleStatus msdt:dt="string">Not started</mso:ArticleStatus>
<mso:HoursDraftingEstimated msdt:dt="string">0.300000000000000</mso:HoursDraftingEstimated>
<mso:HoursEditingEstimated msdt:dt="string">0.100000000000000</mso:HoursEditingEstimated>
<mso:Sample msdt:dt="string">z</mso:Sample>
<mso:DeliveryTarget msdt:dt="string"></mso:DeliveryTarget>
<mso:EditScore msdt:dt="string"></mso:EditScore>
<mso:PrereqOrdering msdt:dt="string">2</mso:PrereqOrdering>
</mso:CustomDocumentProperties>
</xml><![endif]-->
</head>

<body>
<p>Setting up configuration of ProFTPd to use SFTP instead of FTP on Debian and Ubuntu, Security, Linux Basics.</p>
    <h1>Configure ProFTPd to use SFTP instead of FTP – Debian, Ubuntu</h1>
    
    <p><strong>Difficulty</strong>: <em>1</em><br/>
        <strong>Time</strong>: <em>20 minutes</em></p>

    <h2>Introduction</h2>
    <p>ProFTPd is a File Transfer Protocol (FTP) server and an open source software, compatible with Linux/Unix systems and Microsoft windows. SFTP (Secure File Transfer Protocol) which stands for SSH File Transfer Protocol, or Secure File Transfer Protocol, is a separate protocol packaged with SSH that works in a similar way over a secure connection.</p>
    
    <p>In this article, you will learn about configuration of ProFTPd, to use SFTP on Debian and Ubuntu.</p>
 
  <h2>Install ProFTPd</h2>
<ol> 
<li>Update all the packages of operating system and install ProFTPd package  using  the following commands:
   <div class="hacker">sudo  apt-get  -y  update</div>
   <div class="hacker">sudo apt-get install proftpd</div>
   </li>
   <li>Open the configuration file of <code> ProFTPd</code>.
   <div class="hacker">Sudo vim /etc/proftpd/proftpd.conf</div>
   </li>
   <li>Change the <code>ServerName</code> parameter to match your domain name or IP address.
   <div class="hacker">ServerName      "<em><u>yourDomainOrIPAddress</u></em>"</div>
   </li>
   <li>Uncomment the following line:
   <div class="hacker">DefaultRoot     ~</div>
   </li>
   <li>Save and exit.
   <div class="hacker">wq!</div>
   </li>
  </ol>
  
  <h2>Configure SFTP Access with ProFTPd</h2>
<ol> 
<li>Create a blank file in  the <code>/etc/proftpd/conf.d/ </code>directory, to configure SFTP.
   <div class="hacker">sudo vim /etc/proftpd/conf.d/<em><u>sftp.conf</u></em></div>
   </li>
   <li>Add the following lines into  the file:
   <div class="hacker">
<pre>
&lt;IfModule mod_sftp.c&gt;

        SFTPEngine on
        Port 2222
        SFTPLog /var/log/proftpd/sftp.log

        # Configure both the RSA and DSA host keys, using the same host 	key
        # files that OpenSSH uses.
        SFTPHostKey /etc/ssh/ssh_host_rsa_key
        SFTPHostKey /etc/ssh/ssh_host_dsa_key

        SFTPAuthMethods publickey

        SFTPAuthorizedUserKeys file:/etc/proftpd/authorized_keys/%u

        # Enable compression
        SFTPCompression delayed
&lt;/IfModule&gt;
</pre>
   </div>
   </li>
   <li>Save and exit.
   <div class="hacker">Wq!</div>
   </li>
  </ol>
  
  <h2>Configure Key Based Authentication</h2>
<ol> 
<li>Generate authorized key to create a secure connection.
   <div class="hacker">ssh-keygen</div>
   </li>
   <li>Go to  /home/<em><u>UserName</u></em>/.ssh directory.
   <div class="hacker">Cd /home/<em><u>UserName</u></em>/.ssh/</div>
   </li>
   <li>View the content of the following file.
   <div class="hacker">sudo cat id_rsa</div>
   </li>
   <li>Copy all the content from this file and save it into a new file on your local Desktop with .ppk extension. For this article test.ppk is used.
   </li>
   <li>Create a directory to hold authorized private key.
   <div class="hacker">sudo mkdir /etc/proftpd/<em><u>authorized_keys</u></em></div>
   </li>
   <li>Convert the authorized private keys that are currently used to log into the server.
   <div class="hacker">sudo ssh-keygen -e -f /home/<em><u>UserName</u></em>/.ssh/id_rsa.pub | sudo tee /etc/proftpd/authorized_keys//<em><u>UserName</u></em></div>
   </li>
   <li>Restart the ProFTPd service.
   <div class="hacker">sudo service proftpd restart</div>
   </li>
  </ol>
  
  <h2>Disable SFTP access on the SSH Port</h2>
<ol> 
<li>Open the configuration file of SSHD to enable SFTP.  
   <div class="hacker">sudo vim /etc/ssh/sshd_config</div>
   </li>
   <li>Comment the following line using #(hash):
   <div class="hacker">Subsystem sftp /usr/lib/openssh/sftp-server</div>
   </li>
   <li>Save and exit.
   <div class="hacker">wq!</div>
   </li>
   <li>Restart the SSH server services.
   <div class="hacker">sudo service ssh restart</div>
   </li>
   
  </ol>
  
  <h2>Connect with a Client</h2>
<ol> 
<li>Open FileZilla's preferences and go to Edit &rarr; Settings &rarr; SFTP.
   </li>
   <li>Click on add key file button to Add the private key.
  <br/> <img src="x" alt="#"/>
   </li>
   <li>Browse the private file which is saved on local Desktop with file name test.ppk.
   </li>
   <li>Click Ok to save on FileZilla, after adding the private key.
   </li>
   <li>Restart the ProFTPd service.
   <div class="hacker">sudo service proftpd restart</div>
   </li>
   <li>Enter Host 0r IP address, Username, Password and Port number and click Quick Connect button. FileZilla should connect automatically using your SSH keys.
   <br/><img src="x" alt="#"/>
   </li>
  </ol>
  
  
    <h2>Conclusion</h2>
    <p>In this article, you have learnt to Configure ProFTPd, to use SFTP instead of FTP on Debian and Ubuntu. </p>
   
</body>
</html>