<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:mso="urn:schemas-microsoft-com:office:office" xmlns:msdt="uuid:C2F41010-65B3-11d1-A29F-00AA00C14882">

<head>

<!--Article Number is 18569-->
 
<title>Install and configure CouchDB with Elasticsearch - Arch Linux</title>
<style type='text/css'>
div.hacker {
background-color:#666;
border:1px solid #ccc;
color:#fff;
font-family:"Lucida Console","Courier New",Courier,fixed;  font-size:95%;  line-height:160%;  margin-bottom:1.5em;  padding:10px; }

p.note {
 background-color:#ffffe6;
 border:1px solid #eee;
 color:#666;
 padding:.8em 1.6em;
 margin:15px 0;
}

.warning {
 border: 1px #d25100 solid;
 padding: .5em 1em .5em 4em;
 margin: 10px 20px 15px 20px;
 background-image: url('@{help-img-path}/img_warning.gif');
 background-repeat: no-repeat;
 background-position: left top;
 background-color: #ededed;-moz-border-radius:
0.8em;-webkit-border-radius: 0.8em;
 /* -moz-border-bottom-radius: 0;9 */
 -webkit-border-bottom-radius: 0;
 padding-top:14px;
 padding-bottom:15px;
}
</style>


<!--[if gte mso 9]><xml>
<mso:CustomDocumentProperties>
<mso:ArticleKeywords msdt:dt="string">NoSQL</mso:ArticleKeywords>
<mso:Reference msdt:dt="string">https://www.digitalocean.com/community/tutorials/how-to-set-up-couchdb-with-elasticsearch-on-an-ubuntu-13-10-vps, https://www.digitalocean.com/community/tutorials/how-to-set-up-couchdb-with-elasticsearch-on-an-ubuntu-13-10-vps</mso:Reference>
<mso:LinuxDistributions msdt:dt="string">;#Arch Linux;#</mso:LinuxDistributions>
<mso:ArticlePriority msdt:dt="string">7</mso:ArticlePriority>
<mso:RequestNotes msdt:dt="string"></mso:RequestNotes>
<mso:Difficulty msdt:dt="string">2</mso:Difficulty>
<mso:ForkSplit msdt:dt="string"></mso:ForkSplit>
<mso:ArticleID msdt:dt="string">18596</mso:ArticleID>
<mso:UnsupportedFeatures msdt:dt="string"></mso:UnsupportedFeatures>
<mso:Collapsed msdt:dt="string"></mso:Collapsed>
<mso:Complexity msdt:dt="string"></mso:Complexity>
<mso:ArticleStatus msdt:dt="string">Not started</mso:ArticleStatus>


<mso:Sample msdt:dt="string">z</mso:Sample>
<mso:DeliveryTarget msdt:dt="string"></mso:DeliveryTarget>
<mso:EditScore msdt:dt="string"></mso:EditScore>
<mso:PrereqOrdering msdt:dt="string">2</mso:PrereqOrdering>
<mso:AssignedTo1 msdt:dt="string">12</mso:AssignedTo1>
<mso:display_urn_x003a_schemas-microsoft-com_x003a_office_x003a_office_x0023_AssignedTo1 msdt:dt="string">Tom Taylor</mso:display_urn_x003a_schemas-microsoft-com_x003a_office_x003a_office_x0023_AssignedTo1>
</mso:CustomDocumentProperties>
</xml><![endif]-->
</head>

<body>
<p>Install and configure CouchDB with Elasticsearch – Arch Linux, NoSQL</p>
    <h1>Install and configure CouchDB with Elasticsearch – Arch Linux</h1>
    
    <p><strong>Difficulty</strong>: <em>2</em><br/>
        <strong>Time</strong>: <em>1.5 hours</em></p>

    <p>CouchDB is often categorized as a <em>NoSQL</em> database, and it stores data in <em>JSON (JavaScript Object Notation)</em> format. It is a lightweight, data-interchange format that provides Master-Master replication. Elasticsearch is a popular search server, based on Lucene. It is developed in Java language. </p>
<p>This article covers the steps to install and configure CouchDB with Elasticsearch on Arch Linux.</p> <!--Are there any prerequesites for linking?--> <!-- No, there are no pre-requisites for this article -->
<p class="note">This article assumes that user is logged in with sudo user privileges.</p>

<h2>Prepare the system</h2>
  
    <ol>
	<li>Update the Arch Linux machine.
	<div class='hacker'>sudo pacman -Syu</div>
	 </li>
	
	<li>Install Erlang. CouchDB is written in Erlang language.
	<div class='hacker'>sudo pacman –S erlang </div></li>
	<li>From  the provided list of options for repository, choose <code>option 1, mesa-libgl</code>.</li>
	</ol>
	
<h2>Install and configure CouchDB</h2>
    <ol>
	<li>Install CouchDB.
	<div class='hacker'>pacman -S couchdb</div>
	</li>
	<li>Start CouchDB.
	<div class='hacker'>systemctl start couchdb.service</div>
	
    </li>
	
	<li>Run the following command to test CouchDB:
	<div class='hacker'>curl -XGET http://127.0.0.1:5984/</div>
   
	<p>Successful run of CouchDB will show the following message:</p>
   
	<img src="images/18596 - 1.png" alt="18596 - 1.png"/> </li>
	
	<li>Open the config file <code>local.ini</code> for editing.
	<div class='hacker'>vim /etc/couchdb/local.ini</div>
	</li>
	<li>Uncomment and update the following line:
	<div class="hacker">Port:5984</div>
	<div class="hacker">bind_address = <em><u>YOUR_VALID_IP_HERE</u></em>;</div>
    </li>
    <li>Restart the database server CouchDB.
	<div class='hacker'>systemctl start couchdb.service</div>
	</li>
	
	</ol>
	
<h2>Install Elasticsearch </h2>
<!--This procedure has too many steps. Break it into smaller sections with a maximum of 7 steps.  Use h3. You can also combine some commands into the same step, with seperate div.  If they logically go together with no output between.  For example, you could "Install and check Java version" -->
<!-- Broken the setion into other sections, following the strucutre used in other sibling articles.-->
    <ol>
	<li>Install Java. 
	<div class='hacker'>pacman -S jre8-openjdk</div>
	</li>
	<li>Check Java version to ensure successful installation and configuration, using the following command:
	<div class='hacker'>java -version</div>
    </li>
	
	<li>Install the Elasticsearch's deb packages. 
	
	<p class="note">These steps install version 1.7.1. For other versions, visit <strong>elasticsearch.org/download</strong>. </p>
	<div class='hacker'>wget https://download.elastic.co/elasticsearch/elasticsearch/elasticsearch-1.7.1.tar.gz</div>
	<div class='hacker'>sudo tar xzf elasticsearch-1.7.1.tar.gz</div>
	<div class='hacker'>mv elasticsearch-1.7.1 /usr/share/elasticsearch</div>
	</li>
	</ol>

<h2>Configure Elasticsearch </h2>
	<ol>
	<li>Open the configuration file <code>elasticsearch.yml</code> to make updates and enable access from the internet.
	<div class='hacker'>cd /usr/share/elasticsearch</div>
	<div class='hacker'>sudo vim config/elasticsearch.yml</div>
    </li>	
	<li>Locate the following lines, uncomment it by removing the <strong>#</strong>, and enter the IP address of the server. It is usually under the section <code>Network And HTTP</code>.
	<div class="hacker">network.bind_host: <em><u>YOUR_VALID_IP_HERE</u></em></div>
	</li>
	
	<li>Locate and uncomment the following code:
	<div class='hacker'>network.publish_host: 127.0.0.1 </div>
	</li>
	
	<li>Insert following line anywhere under the section <code>Security</code> (usually at the end of the file):  
	<div class='hacker'>script.disable_dynamic: true</div>
	</li>
	
	<li>Save the file and exit, by pressing the <strong>Esc</strong> key, and pressing <strong>:wq</strong>.
	</li>
	
	<li>Restart the Elasticsearch service for the changes to take effect. <!--This makes no sense. Can you make it less jargony?--><!--Updated accordingly.-->
	<div class='hacker'>./bin/elasticsearch</div>
	
	<p>Upon successful start, it would show a <strong>Started</strong> message.</p>
	<img src="images/18596 - 2.png" alt="18596 - 2.png"/>
  <!--The image is too wide.  According to the guidelines, 600px max.-->
  <!--Updated the image accordingly.-->
	</li>
	
	<li>Open a new terminal (or connect to the machine using another client), and test Elasticsearch using the following command: 
	<div class='hacker'>curl http://127.0.0.1:9200</div>
	</li>
	
	Successful execution will display the following output:
	<div class='hacker'>
	<pre>
{
  "ok" : true,
  "status" : 200,
  "name" : "Mason, Louise",
  "version" : {
    "number" : "0.90.8",
    "build_hash" : "909b037218cf880e8772b066a764f179f2d5e719",
    "build_timestamp" : "2013-12-18T16:08:16Z",
    "build_snapshot" : false,
    "lucene_version" : "4.6"
  },
  "tagline" : "You Know, for Search"
}
</pre>
	</div>
	<img src="images/18596 - 3.png" alt="18596 - 3.png"/>
    <!--The image is too wide.  According to the guidelines, 600px max.-->
    <!--Updated the image accordingly.-->
	</li>
	</ol>
	 
<h2>Test CounchDB with Elasticsearch</h2>

    <ol>
	<li>Switch back to the terminal where Elasticsearch was running, and press <strong>CTRL+C</strong> to stop ElasticSearch<!--This is an awkward sentence.-->
	<!-- Updated the sentence. Hope this works.--><br />
	<img src="images/18596 - 4.png" alt="18596 - 4.png"/>
    <!--The image is too wide.  According to the guidelines, 600px max.-->
	<!--Updated the image accordingly.-->
	</li>
	
	<li>Create new directory for Elasticsearch Stores Indices.
	<div class='hacker'>vim /usr/share/elasticsearch/config/elasticsearch.yml</div>
	</li>
	
	<li>Locate the following code:
	<div class='hacker'>#Path to where plugins are installed:
<br />#
<br />#path.plugins: /path/to/plugins
</div>
	</li>
	
	<li>Uncomment the code by removing the <strong>#</strong>, and update it to the following:<!--What is it?--><!-- Here iit refers to the code located just above. Updated sentence accordingly-->
	<div class='hacker'>#Path to where plugins are installed:
<br />#
<br />path.plugins: /usr/share/elasticsearch/plugins
</div>
	</li>
	
	<li>Install the <code>elasticsearch-river-couchdb</code> plugin.
	<div class='hacker'>cd /usr/share/elasticsearch/bin</div>
	<div class='hacker'>sh plugin install elasticsearch/elasticsearch-river-couchdb/2.6.0</div>
	</li>
	
	
	<li>Restart the Elasticsearch.
	<div class='hacker'>./elasticsearch
</div>
	</li></ol>
<h2>Create a sample CouchDB database, and set up the Elasticsearch index</h2>
<ol>
<li>Open a new terminal (or connect to the machine using another client), and test Elasticsearch using the following command: 
<div class='hacker'>curl -X PUT <u>http://127.0.0.1:5984/mydb</u></div>
<p>Successful execution will display the following message:</p>
<div class='hacker'>{"ok":true}</div>
</li>

   <li>Create the sample documents.
   <div class="hacker">curl -X PUT 'http://127.0.0.1:5984/mydatabase/1' -d '{"name":"My Name 1"}'</div>
   <div class="hacker">curl -X PUT 'http://127.0.0.1:5984/mydatabase/1' -d '{"branch:”my brach 1"}'</div>
   <div class="hacker">curl -X PUT 'http://127.0.0.1:5984/mydatabase/1' -d '{"roll no:”my rollno  1"}'</div>
   </li>
	
	<li>Set up ElasticSearch with the CouchDB database by creating an index.
	<div class='hacker'>
curl -X PUT '127.0.0.1:9200/_river/mydb/_meta' -d '{ "type" : "couchdb", "couchdb" : { "host" : "localhost", "port" : 5984, "db" : "mydb", "filter" : null }, "index" : { "index" : "mydb", "type" : "mydb", "bulk_size" : "100", "bulk_timeout" : "10ms" } }'
	</div>
	</li>
	
	<li>Test the index by firing the following query:
	<div class='hacker'>curl http://127.0.0.1:9200/mydb/mydb/_search?pretty=true</div>
	<p> Successful execution of query would result in the following output:</p>
	<div class='hacker'>
	<pre>
{
  "took" : 69,
  "timed_out" : false,
  "_shards" : {
    "total" : 5,
    "successful" : 5,
    "failed" : 0
  },
  "hits" : {
    "total" : 4,
    "max_score" : 1.0,
    "hits" : [ {
      "_index" : "mydb",
      "_type" : "mydb",
      "_id" : "4",
      "_score" : 1.0,
      "_source":{"_rev":"1-8596f0546d30c466c3094f309023d145","name":"Name 4","_id":"4"}
    }, {
      "_index" : "mydb",
      "_type" : "mydb",
      "_id" : "1",
      "_score" : 1.0,
      "_source":{"_rev":"1-405492a75edaedac1183d77aafe60958","name":"Name 1","_id":"1"}
    }, {
      "_index" : "mydb",
      "_type" : "mydb",
      "_id" : "2",
      "_score" : 1.0,
      "_source":{"_rev":"1-17e5fdad9f957d8b365833cdecc3a8b6","name":"Name 2","_id":"2"}
    }, {
      "_index" : "mydb",
      "_type" : "mydb",
      "_id" : "3",
      "_score" : 1.0,
      "_source":{"_rev":"1-91d26403a8e4de569a97f06fb9bbb057","name":"Name 3","_id":"3"}
    } ]
  }
}
</pre>
</div>
	</li>
	 </ol>
    <h2>Conclusion</h2>
<p>In this article, you installed and configured CouchDB with Elasticsearch. With the combination of CouchDB, Elasticsearch can perform full text queries on data. This reduces the dependency on map-reduce. Also, when using Elasticsearch with CouchDB, the user need not know the document ID, which further enhances the efficiency.</p>   
</body>
</html>